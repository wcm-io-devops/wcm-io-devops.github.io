
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2024-11-20
 Rendered using Reflow Maven Skin 1.1.0 (https://github.com/wcm-io/wcm-io-tooling/tree/develop/maven/skins/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

  <head>
    <meta charset="UTF-8" />
    <title>CONGA - YAML definitions | CONGA</title>

    <link rel="shortcut icon" href="https://wcm.io/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://wcm.io/images/favicon-152.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="wcm.io DevOps - Tools for Configuration Management and Deployment" />
    <meta http-equiv="content-language" content="en" />

    <link href="https://devops.wcm.io/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://devops.wcm.io/css/docs.css" rel="stylesheet" />
    <link href="https://devops.wcm.io/css/reflow-skin.css" rel="stylesheet" />
    <link href="https://devops.wcm.io/css/highlightjs-style-github.min.css" rel="stylesheet" />

    <link href="https://devops.wcm.io/css/lightbox.css" rel="stylesheet" />

    <link href="https://devops.wcm.io/css/site.css" rel="stylesheet" />
    <link href="https://devops.wcm.io/css/print.css" rel="stylesheet" media="print" />


  </head>

  <body class="page-yaml-definitions project-io.wcm.devops.conga.root" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="..">wcm.io DevOps</a>
          <div class="nav-collapse collapse" id="top-nav-collapse">
            <ul class="nav pull-right">
              <li ><a href="http://github.com/wcm-io-devops" title="GitHub project" class="externalLink">GitHub project</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Categories <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="./" title="CONGA - CONfiguration GenerAtor">CONGA - CONfiguration GenerAtor</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="https://wcm.io/contribute.html" title="Contribute" class="externalLink">Contribute</a></li>
                  <li ><a href="https://github.com/wcm-io-devops" title="Issues" class="externalLink">Issues</a></li>
                  <li ><a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a></li>
                  <li ><a href="https://wcm.io/mailing-lists.html" title="Mailing Lists" class="externalLink">Mailing Lists</a></li>
                  <li ><a href="http://github.com/wcm-io-devops" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  <div class="container">

  <!-- Masthead
  ================================================== -->

  <header>
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="span12">
        <div class="pull-left">
          <a href="../" id="bannerLeft"><h1><img src="https://wcm.io/images/favicon-16@3x.png"/> wcm.io DevOps</h1></a>
          <p class="lead">Tools for Configuration Management and Deployment</p>
        </div>
        <div class="pull-right">
          <div id="bannerRight"><h1><img src="https://devops.wcm.io/conga/images/conga.png" style="height:120px"/></h1></div>
        </div>
      </div>
    </div>
  </div>
    <div>
      <ul class="breadcrumb">
        <li><a href="../" title="wcm.io DevOps">wcm.io DevOps</a></li>
        <li class="divider">/</li>
        <li><a href="index.html" title="CONGA">CONGA</a></li>
        <li class="divider">/</li>
        <li>CONGA - YAML definitions</li>
      </ul>
    </div>
  </header>

  <div class="main-body">
  <div class="row">
    <div class="span8">
      <div class="body-content">
<section> 
 <div class="page-header">
  <h2 id="CONGA_-_YAML_definitions">CONGA - YAML definitions</h2>
 </div> 
 <p>CONGA uses <a class="externalLink" href="http://yaml.org/">YAML</a> to describe roles and environments.</p> 
 <p><a class="externalLink" href="http://www.snakeyaml.org/">SnakeYAML</a> is used to parse the definition files and map them to a Java object model. Because of this the detailed YAML file documentation are the JavaDocs of the model classes.</p> 
 <p>Please note that the Java Bean naming conventions are applied: For the property names in the YAML files the “get” prefix from the model class is omitted, and the property is written in headless camel case. Example: <code>getRoleConfig()</code> method name results in <code>roleConfig</code> property name.</p> 
 <section> 
  <h3 id="Role_definitions">Role definitions</h3> 
  <p>Example role definitions:<br> <a class="externalLink" href="https://github.com/wcm-io-devops/conga/tree/develop/tooling/conga-maven-plugin/src/it/example/definitions/src/main/roles">https://github.com/wcm-io-devops/conga/tree/develop/tooling/conga-maven-plugin/src/it/example/definitions/src/main/roles</a></p> 
  <p>The filename of the role YAML file is the role name.</p> 
  <p>The documentation of all role and file configuration options can be found in the<br> <a href="generator/apidocs/io/wcm/devops/conga/model/role/Role.html">Role Model API documentation</a>.</p> 
  <section> 
   <h4 id="Files">Files</h4> 
   <p>Files are generated using a Handlebars template. After generation a file header is added automatically, and the file syntax is checked for well-formedness. Optionally additional post-processors can be configured.</p> 
   <p>Alternatively it is possible to specify an URL instead of a template. In this case the file is copied/downloaded from an external source. The following URL prefixes are supported out of the box:</p> 
   <ul> 
    <li><code>file:</code> - Absolute filesystem path</li> 
    <li><code>file-node:</code> - Filesystem path relative to the node root in the target directory of generated files</li> 
    <li><code>classpath:</code> - Classpath resource reference</li> 
    <li><code>http://</code> or <code>https://</code> - External URL</li> 
    <li><code>mvn:</code> - Maven Artifact coordinates (only supported when CONGA runs inside Maven) 
     <ul> 
      <li>Maven Coordinates Syntax 1 (<a class="externalLink" href="https://maven.apache.org/pom.html#Maven_Coordinates">Maven-style</a>): <code>groupId:artifactId[:packaging][:classifier]:version</code></li> 
      <li>Maven Coordinates Syntax 2 (<a class="externalLink" href="https://ops4j1.jira.com/wiki/x/CoA6">Pax URL-style</a>): <code>groupId/artifactId/version[/type][/classifier]</code></li> 
      <li><code>classifier</code> and <code>type</code> are optional</li> 
      <li>if the version is empty in the role file it is resolved from the Maven project</li> 
     </ul> </li> 
   </ul> 
   <p>If no prefix is specified the URL is interpreted as path relative to the POM root directory in the local filesystem.</p> 
  </section> 
  <section> 
   <h4 id="Role_Inheritance">Role Inheritance</h4> 
   <p>A role can inherit from one or multiple other roles:</p> 
   <div class="source"> 
    <pre><code class="language-yaml">inherits:
- role: superRole
</code></pre> 
   </div> 
   <p>In this case the current role inherits all configuration and files from the super role(s). Configuration maps are merged, the config of the current role has higher precedence. If the super role defines variants, the current has to define the same variants as well. Files in the current role with the same target file name as a file in a super role have higher precedence than the files from the super role.</p> 
  </section> 
 </section> 
 <section> 
  <h3 id="Environment_definitions">Environment definitions</h3> 
  <p>Example environment definitions:<br> <a class="externalLink" href="https://github.com/wcm-io-devops/conga/tree/develop/tooling/conga-maven-plugin/src/it/example/environments/src/main/environments">https://github.com/wcm-io-devops/conga/tree/develop/tooling/conga-maven-plugin/src/it/example/environments/src/main/environments</a></p> 
  <p>The filename of the environment YAML file is the environment name.</p> 
  <p>The documentation of all environment and node configuration options can be found in the<br> <a href="generator/apidocs/io/wcm/devops/conga/model/environment/Environment.html">Environment Model API documentation</a>.</p> 
 </section> 
 <section> 
  <h3 id="Configuration_parameter_maps">Configuration parameter maps</h3> 
  <p>On nearly every element within the YAML structure configuration parameter maps can be applied. Example:</p> 
  <div class="source"> 
   <pre><code class="language-yaml">config:
  param1: value1
  group1:
    param11: 5
    param12: true
  list1:
  - listValue1
  - listValue2
</code></pre> 
  </div> 
  <p>Parameter names can be nested in object in any depth. Lists are supported as well.</p> 
  <p>For nested groups a short notation is supported using a “.” notation.</p> 
  <p>This example is equivalent to the previous one:</p> 
  <div class="source"> 
   <pre><code class="language-yaml">config:
  param1: value1
  group1.param11: 5
  group1.param12: true
  list1:
  - listValue1
  - listValue2
</code></pre> 
  </div> 
  <p>Within the configuration parameters maps other parameters can be referenced using a variable notation. Example: <code>${group1.param1}</code>. Nested variable references are supported, just make sure you define no cyclic dependencies.</p> 
  <p>Configuration parameter maps are inherited to “deeper levels” within the YAML structure, and the maps are merged on each level. The configuration parameters on the “deeper levels” overwrite the parameters from the higher level.</p> 
  <p>Inheritance order (higher number has higher precedence):</p> 
  <ol style="list-style-type: decimal"> 
   <li>Global configuration parameters from role definition</li> 
   <li>Configuration from role variant definition 
    <ul> 
     <li>If multiple variants are assigned to a node/role their configs are merged, first variants have higher precedence</li> 
    </ul> </li> 
   <li>Global configuration from environment</li> 
   <li>Node configuration from environment</li> 
   <li>Global role configuration from environment</li> 
   <li>Role configuration from node</li> 
   <li>Variant configuration from node</li> 
   <li>Configuration from multiply plugins, e.g. the tenant-specific configuration</li> 
  </ol> 
  <p>There is a special support when merging list parameter. By default a list value on a deeper lever overwrites a list inherited from a parameter map on a higher level completely. If you insert the keyword <code>_merge_</code> as list item on either of the list values, they are merged and the special keyword entry is removed.</p> 
 </section> 
 <section> 
  <h3 id="Variable_references">Variable references</h3> 
  <p>You can reference configuration parameter values defined in the environment, or as default values in the roles using this variable syntax:</p> 
  <div class="source"> 
   <pre><code>${myvariable}
${mygroup.myvariable}
</code></pre> 
  </div> 
  <p>If no value is defined for this variable, the configuration generation fails. It is recommended to define a default value in the role definition for each variable it uses. An alternative is to define a default value within the variable reference like this:</p> 
  <div class="source"> 
   <pre><code>${myvariable:defaultValue}
${myvariable:defaultListItem1,item2,item3}
</code></pre> 
  </div> 
  <p>You can reference values from external source via value providers (see <a href="extensibility.html">Extensibility model</a>), e.g. from the “System Parameter Value Provider”:</p> 
  <div class="source"> 
   <pre><code>${system::my.system.parameter}
${system::my.system.parameter:defaultValue}
</code></pre> 
  </div> 
  <p>Instead of single variable expression you can also use Java Expression Language (<a class="externalLink" href="http://commons.apache.org/proper/commons-jexl/">JEXL</a>). This cannot be combined with value provider expressions or default values. Examples:</p> 
  <div class="source"> 
   <pre><code>${myvariable1 + '/' + myvariable2}
${mygroup.myvariable == 'expected_value'}
${mynumber + 1}
${new('java.text.DecimalFormat','000').format(multiplyIndex)}
${stringUtils:join(listParam,'|')}
</code></pre> 
  </div> 
  <p>When you escape the dollar sign with a backslash the variable is untouched by CONGA:</p> 
  <div class="source"> 
   <pre><code>\${my-static-string}
</code></pre> 
  </div> 
 </section> 
 <section> 
  <h3 id="Iterate_over_variable_list_values">Iterate over variable list values</h3> 
  <p>When reading a variable with list of values from external source via a value provider, it may be required to generate a list of configuration statements within an environment definition. In this case the <code>_iterate_</code> keyword can be used.</p> 
  <p>Example from an environment definition file:</p> 
  <div class="source"> 
   <pre><code>- node: author1
  roles:
  - role: aem-cms
    variant: aem-author
  config:
    replication.author.publishTargets:
      _iterate_: ${system::publishTransportUrls}
      name: publish${_itemIndex_}
      host: ${_item_}
      transportUser: ...
      transportPassword: ...
</code></pre> 
  </div> 
  <p>In this example a list of hostnames/transport URLs is read from system parameter <code>publishTransportUrls</code>. For each item a configuration block is generated. The following implicit variables can be references inside the ‘iterate’ block:</p> 
  <ul> 
   <li><code>_item_</code>: The list item value</li> 
   <li><code>_itemIndex_</code> The list item index (starting with 0)</li> 
  </ul> 
  <p>The example above results in an environment configuration like this when the configuration is generated:</p> 
  <div class="source"> 
   <pre><code>- node: author1
  roles:
  - role: aem-cms
    variant: aem-author
  config:
    replication.author.publishTargets:
    - name: publish0
      host: http://publish1:4503
      transportUser: ...
      transportPassword: ...
    - name: publish1
      host: http://publish2:4503
      transportUser: ...
      transportPassword: ...
</code></pre> 
  </div> 
 </section> 
 <section> 
  <h3 id="Default_context_properties">Default context properties</h3> 
  <p>Additionally to the variables defined in the configuration parameter maps a set of default context properties are defined automatically by CONGA and merged with the parameter maps:</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Property</th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td align="left"><code>version</code></td> 
     <td>Environment version</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>nodeRole</code></td> 
     <td>Current node role name</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><code>nodeRoleVariant</code></td> 
     <td>Current node role variant name (only set if the role has exactly one variant)</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>nodeRoleVariants</code></td> 
     <td>List of current node role variant names</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><code>environment</code></td> 
     <td>Environment name</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>node</code></td> 
     <td>Current node name</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><code>nodes</code></td> 
     <td>List of all nodes. Each node has properties as defined in the <a href="generator/apidocs/io/wcm/devops/conga/model/environment/Node.html">Node model</a>.</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>nodesByRole</code></td> 
     <td>Map with node roles with each entry containing a list of all nodes with this role. Each node has properties as defined in the <a href="generator/apidocs/io/wcm/devops/conga/model/environment/Node.html">Node model</a>.</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><code>nodesByRoleVariant</code></td> 
     <td>Map with node roles with each entry containing a map with node role variants each entry containing a list of all nodes with this role and variant. Each node has properties as defined in the <a href="generator/apidocs/io/wcm/devops/conga/model/environment/Node.html">Node model</a>.</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>tenants</code></td> 
     <td>List of all tenants. Each tenant has properties as defined in the <a href="generator/apidocs/io/wcm/devops/conga/model/environment/Tenant.html">Tenant model</a>.</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><code>tenantsByRole</code></td> 
     <td>Map with tenant roles with each entry containing a list of all tenants with this role. Each tenant has properties as defined in the <a href="generator/apidocs/io/wcm/devops/conga/model/environment/Tenant.html">Tenant model</a>.</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>tenant</code></td> 
     <td>Current tenant name. This is only set if the tenant multiple plugin is used.</td> 
    </tr> 
    <tr class="b"> 
     <td align="left"><code>tenantRoles</code></td> 
     <td>List of current tenant's role names This is only set if the tenant multiply plugin is used.</td> 
    </tr> 
    <tr class="a"> 
     <td align="left"><code>multiplyIndex</code></td> 
     <td>File index (starting with 0) if a multiply plugin is used.</td> 
    </tr> 
   </tbody> 
  </table> 
 </section> 
</section>
      </div>
    </div>
    <div class="span4">
      <div id="toc-sidebar">
        <div class="well">
          <ul class="nav nav-list">
            <li class="nav-header">Table of Contents</li>
    <li class="dropdown"><a href="#CONGA_-_YAML_definitions" title="CONGA - YAML definitions">CONGA - YAML definitions <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li class="dropdown"><a href="#Role_definitions" title="Role definitions">Role definitions <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#Files" title="Files">Files</a>
    <li><a href="#Role_Inheritance" title="Role Inheritance">Role Inheritance</a>
        <li class="divider"></li>
      </ul>
    </li>
    <li><a href="#Environment_definitions" title="Environment definitions">Environment definitions</a>
    <li><a href="#Configuration_parameter_maps" title="Configuration parameter maps">Configuration parameter maps</a>
    <li><a href="#Variable_references" title="Variable references">Variable references</a>
    <li><a href="#Iterate_over_variable_list_values" title="Iterate over variable list values">Iterate over variable list values</a>
    <li><a href="#Default_context_properties" title="Default context properties">Default context properties</a>
        <li class="divider"></li>
      </ul>
    </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>

  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Main</li>
            <li >
              <a href="../" title="Home">Home</a>
            </li>
            <li >
              <a href="../platforms.html" title="Platforms">Platforms</a>
            </li>
            <li >
              <a href="../maven.html" title="Maven Repositories">Maven Repositories</a>
            </li>
            <li >
              <a href="http://github.com/wcm-io-devops" title="GitHub project" class="externalLink">GitHub project</a>
            </li>
            <li >
              <a href="https://wcm.io/subprojects.html" title="Subprojects" class="externalLink">Subprojects</a>
            </li>
            <li >
              <a href="http://www.apache.org/licenses/LICENSE-2.0.txt" title="License" class="externalLink">License</a>
            </li>
            <li >
              <a href="https://wcm.io/commercial-support.html" title="Commercial Support" class="externalLink">Commercial Support</a>
            </li>
            <li >
              <a href="https://diva-e.com/en/imprint/" title="Imprint" class="externalLink">Imprint</a>
            </li>
            <li >
              <a href="https://wcm.io/privacy.html" title="Privacy Policy" class="externalLink">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Categories</li>
            <li >
              <a href="./" title="CONGA - CONfiguration GenerAtor">CONGA - CONfiguration GenerAtor</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Contribute</li>
            <li >
              <a href="https://wcm.io/contribute.html" title="Contribute" class="externalLink">Contribute</a>
            </li>
            <li >
              <a href="https://github.com/wcm-io-devops" title="Issues" class="externalLink">Issues</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a>
            </li>
            <li >
              <a href="https://wcm.io/mailing-lists.html" title="Mailing Lists" class="externalLink">Mailing Lists</a>
            </li>
            <li >
              <a href="http://github.com/wcm-io-devops" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Maven documentation</li>
            <li >
              <a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
            </li>
            <li >
              <a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-description">
          <blockquote>wcm.io DevOps is an Open Source project which provides tools for configuration management and deployment.</blockquote>
        </div>
      </div>
    </div>
  </footer>

  <div class="container subfooter">
    <div class="row">
      <div class="span12">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2015-2024 <a href="https://devops.wcm.io">wcm.io DevOps</a>. All Rights Reserved.</p>
        <p class="version-date"><span class="projectVersion">Version: 1.17.1-SNAPSHOT. </span><span class="publishDate">Last Published: 2024-11-20. </span></p>
      </div>
    </div>
  </div>

  <!-- JavaScript
  ================================================== -->
  <script src="https://devops.wcm.io/js/jquery.min.js"></script>
  <script src="https://devops.wcm.io/js/bootstrap.min.js"></script>
  <script src="https://devops.wcm.io/js/lightbox.min.js"></script>
  <script src="https://devops.wcm.io/js/reflow-scroll.js"></script>
  <script src="https://devops.wcm.io/js/highlight.min.js"></script>


  <script src="https://devops.wcm.io/js/reflow-skin.js"></script>

  </body>
</html>